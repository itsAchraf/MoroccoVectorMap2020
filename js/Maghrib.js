"use strict";
jQuery(document).ready(function() {

    function processData(allText) {
        var allTextLines = allText.split(/\r\n|\n/);
        var headers = allTextLines[0].split(',');
        var lines = [];

        for (var i = 1; i < allTextLines.length; i++) {
            var data = allTextLines[i].split(',');
            if (data.length == headers.length) {

                var tarr = [];
                for (var j = 0; j < headers.length; j++) {
                    tarr.push(data[j]);
                }
                lines.push(tarr);
            }
        }
        var index = 1;
        Object.keys(gdpData).forEach(function(key) { gdpData[key] = lines[lines.length - 1][index++] });
    }

    function readTextFile(file) {
        var rawFile = new XMLHttpRequest();
        rawFile.open("GET", file, false);
        rawFile.onreadystatechange = function() {
            if (rawFile.readyState === 4) {
                if (rawFile.status === 200 || rawFile.status == 0) {
                    var allText = rawFile.responseText;
                    processData(allText)
                }
            }
        }
        rawFile.send(null);
    }
    var gdpData = {
        "ALG": 0,
        "MAU": 0,
        "MAR": 0,
        "TUN": 0,
        "LIB": 0
    };
    readTextFile("https://raw.githubusercontent.com/achrafelouardigui/covid_19_data/master/Maghreb_covid_19_data/Maghreb_covid19_confirmed.csv");

    jQuery.fn.vectorMap("addMap", "morocco_map", {
        paths: {
            MAR: {
                path: "M284.57 371.41C284.41 371.42 284.23 371.46 284.02 371.55C282.75 372.13 281.25 372.61 279.84 372.33C278.68 372.11 277.32 376.03 276.98 376.79C273.38 384.66 268.75 395.39 260.71 399.27C256.65 401.23 252.23 402.34 248.02 403.90C244.16 405.32 241.51 408.59 238.31 411.15C236.81 412.34 235.15 413.70 234.43 415.58C233.43 418.18 233.74 420.58 231.71 422.74C228.16 426.52 226.06 428.79 225.34 434.21C225.08 436.15 225.01 437.96 224.04 439.68C223.06 441.41 223.95 441.51 225.16 442.60C228.29 445.40 223.76 451.72 221.84 453.88C219.00 457.06 216.27 460.59 212.85 463.11C209.29 465.76 205.77 467.96 202.34 470.85C198.83 473.79 194.38 474.81 190.02 475.43C187.67 475.76 185.22 475.66 182.91 476.32C182.27 476.50 180.26 479.27 179.66 479.85C179.73 479.85 179.97 479.87 180.06 479.88L179.56 479.85C179.31 480.61 177.23 484.23 175.98 486.96C173.54 492.24 170.75 494.30 165.76 496.71C161.23 498.89 159.46 503.88 157.34 508.35C154.74 513.81 155.17 518.63 150.45 522.86C146.90 526.04 141.66 528.92 139.32 533.22C139.89 532.37 140.67 531.63 141.56 531.15C142.61 533.45 137.64 538.87 136.38 540.47C135.60 541.48 135.96 543.39 135.02 543.86C133.37 544.71 133.19 547.23 132.57 548.83C131.37 551.96 128.60 551.73 126.87 554.16C125.44 556.17 124.65 558.40 124.06 560.79C123.18 564.28 119.91 569.85 121.48 573.43C121.34 570.93 122.37 565.30 125.71 565.58L169.26 569.32C172.00 568.76 171.23 554.96 171.29 552.33C171.39 547.81 173.10 545.40 176.96 543.35C179.53 541.98 182.86 542.07 185.34 540.52L190.21 504.88L229.40 507.77L232.21 483.91L232.12 483.91C232.83 480.27 233.55 476.22 233.62 472.51C233.68 468.76 235.94 468.64 238.68 466.71C240.08 465.72 241.73 465.16 243.10 464.16C244.40 463.22 245.46 461.74 247.02 461.24C248.38 460.81 249.59 461.17 250.74 460.08C251.88 459.01 252.89 458.26 254.51 458.27C256.80 458.29 259.44 460.79 260.68 457.86C261.84 455.12 264.21 456.32 266.49 456.43C269.53 456.56 273.45 455.94 275.74 453.69C277.74 451.73 279.00 448.80 281.60 447.57C282.94 446.93 284.48 447.11 285.88 446.74C287.74 446.25 289.56 444.66 291.18 443.63C292.73 442.65 295.04 443.36 296.51 442.08C297.79 440.97 293.02 438.65 295.93 436.32C292.83 435.14 295.99 431.91 298.31 432.32C301.36 432.85 304.31 431.95 305.66 429.04C308.25 423.46 322.09 429.79 326.26 429.05C322.45 427.16 330.11 424.42 327.82 422.18C326.58 420.96 325.21 420.21 324.45 418.54C323.93 417.41 324.56 416.42 324.06 415.19C323.05 412.79 322.86 411.82 323.66 409.26C324.20 407.55 323.27 406.44 323.23 404.80C323.17 402.76 324.00 400.97 323.82 398.85C323.71 397.51 323.47 395.68 324.76 394.80C322.62 393.67 324.33 392.28 323.74 390.55C323.23 389.04 321.37 388.28 320.38 387.16C319.47 386.11 318.65 384.30 316.96 385.01C315.56 385.59 314.12 385.05 313.18 383.96C313.90 385.19 312.34 384.45 312.24 383.38C312.14 382.24 311.79 381.85 311.95 380.38C309.30 384.72 304.78 381.97 301.04 382.11C296.52 382.29 293.22 382.81 289.56 379.58C287.80 378.04 286.78 376.45 286.10 374.16C285.80 373.13 285.68 371.35 284.57 371.41zM179.56 479.85C179.61 479.67 179.57 479.66 179.40 479.83L179.56 479.85zM312.73 383.30C312.84 383.49 312.95 383.67 313.09 383.83C312.99 383.68 312.89 383.51 312.73 383.30z",
                name: "Maroc"
            },
            MAU: {
                path: "M121.48 573.43C121.36 571.14 121.68 569.60 122.73 567.50C123.02 566.91 123.96 565.52 125.49 565.57L169.41 569.28C171.75 568.25 171.09 558.02 171.27 554.12C171.33 550.18 171.17 547.61 174.44 544.90C177.17 542.63 177.03 543.26 185.34 540.54L190.17 504.90L229.40 507.78L231.48 489.68C245.51 501.41 259.22 513.42 272.65 525.88C265.73 525.29 258.76 524.69 251.84 524.10L250.12 644.36C250.65 646.38 252.51 647.39 252.65 647.86C253.53 651.00 251.94 651.79 251.64 654.12C251.27 656.85 250.80 659.30 250.01 659.53L224.98 657.42C210.72 656.71 204.46 658.21 203.58 653.73C202.63 657.64 196.94 657.80 194.25 656.41C190.02 654.22 187.15 654.74 184.91 659.73C184.04 657.89 182.68 656.26 181.29 654.60C179.64 652.64 177.98 651.52 176.97 651.99C173.19 653.76 177.32 664.65 168.52 663.23C168.55 663.40 166.29 661.23 165.75 659.90C165.09 658.24 164.13 658.67 162.72 657.18C161.19 655.57 161.51 653.18 160.23 652.12C156.81 649.29 158.26 649.38 158.07 647.65C157.83 645.51 156.01 642.66 154.98 642.56C149.64 642.02 149.64 637.47 146.32 635.43C144.65 634.40 143.16 633.81 140.81 633.52C137.15 633.08 135.56 636.71 127.18 635.33C125.42 635.04 125.76 633.83 124.21 634.14C122.69 634.58 120.54 639.35 119.84 640.59C120.57 632.07 126.56 625.57 128.06 617.28C128.96 612.29 128.66 607.97 128.47 602.99C128.41 601.20 128.63 599.25 127.67 597.65C126.84 596.26 125.27 595.18 125.25 593.38C126.48 593.89 127.95 593.04 127.93 591.58C127.05 591.75 126.31 592.36 125.95 593.20C126.40 591.51 127.83 590.42 128.68 588.98C129.23 588.05 128.69 586.44 129.29 585.83C132.01 583.11 128.68 577.57 128.00 574.59C127.56 575.25 127.23 575.98 127.02 576.76C124.69 574.58 125.64 570.55 123.29 568.35C122.74 570.06 121.99 571.70 121.48 573.43",
                name: "Mauritanie"
            },
            ALG: {
                path: "M231.37 489.64L233.71 471.88C233.38 467.03 240.57 466.05 243.32 463.86C244.69 462.77 246.96 460.51 248.89 460.80C250.56 461.05 251.18 458.44 253.44 458.18C257.11 457.77 258.65 461.57 261.25 456.77C262.06 455.29 264.25 456.13 265.56 456.06C267.92 455.94 270.29 455.81 272.56 455.16C277.12 453.84 277.73 448.92 281.67 447.17C283.29 446.45 285.33 446.53 287.02 446.04C289.10 445.44 290.63 443.20 292.74 442.94C293.52 442.85 297.64 442.86 296.16 440.47C295.20 438.92 293.53 438.25 295.93 436.32C292.83 435.14 296.00 431.92 298.31 432.33C301.37 432.86 304.32 431.96 305.67 429.05C308.26 423.47 322.09 429.80 326.26 429.06C321.78 426.46 330.09 424.48 327.72 422.23C326.61 421.16 325.34 420.20 324.47 418.88C323.47 417.37 324.23 415.38 323.27 413.54C322.27 411.62 323.04 410.18 323.53 408.40C323.99 406.73 322.73 406.60 323.05 404.97C323.35 403.44 323.48 401.58 323.63 400.05C323.84 398.00 322.66 396.23 324.76 394.80C322.80 393.76 323.72 392.65 323.56 391.04C323.35 388.90 319.89 387.91 319.31 385.67C323.08 385.98 324.78 385.17 328.13 383.74C329.59 383.12 330.47 383.19 331.44 381.73C332.30 380.44 332.96 379.35 334.41 378.70C335.23 378.33 336.85 377.19 337.62 377.94C338.62 378.92 340.10 377.50 340.87 376.89C342.87 375.28 345.03 379.93 347.27 376.05C350.27 370.84 359.20 369.25 364.37 369.07C368.05 368.95 371.82 368.22 375.47 368.80C378.19 369.22 380.39 365.75 382.64 367.35C383.62 368.05 383.42 367.69 383.87 367.05C383.97 366.91 388.07 367.32 388.70 367.12C392.37 365.96 395.91 366.82 399.65 367.03C402.76 367.21 403.44 367.94 405.65 370.00C408.47 372.64 409.82 369.22 412.47 369.11C413.32 369.07 418.57 369.29 418.42 367.65C418.16 364.70 421.81 366.82 422.66 367.53C424.44 369.01 427.23 369.92 429.31 368.48C430.45 367.68 429.85 366.47 431.83 367.17C433.24 367.66 434.28 368.86 435.85 368.91C434.33 371.08 437.68 370.56 438.75 370.37C440.87 369.98 443.07 370.70 445.12 370.18C445.02 373.13 441.31 374.27 439.59 376.01C443.76 377.33 439.14 383.20 439.76 386.12C440.82 391.20 439.88 394.89 438.46 399.69C437.29 403.64 432.72 406.40 429.62 408.80C427.82 410.19 428.29 414.28 429.12 416.06C430.46 418.96 429.48 421.90 432.63 423.47C436.93 425.61 435.12 431.36 438.47 434.46C440.02 435.90 441.90 437.01 443.17 438.76C444.89 441.12 444.85 444.75 445.06 447.59C445.48 453.44 447.56 460.07 447.06 465.89C446.92 467.46 443.80 466.59 445.60 469.60C447.35 472.53 448.71 475.90 449.07 479.35C450.32 491.20 447.02 490.84 448.19 496.96C448.75 499.88 448.62 501.97 447.31 504.66C445.84 507.69 446.69 510.71 447.07 513.89C447.65 518.70 445.63 518.60 442.18 520.86C438.26 523.44 443.89 529.59 445.26 532.28C447.84 537.31 445.56 542.83 449.14 547.63C450.52 549.47 452.45 547.57 454.06 547.83C456.10 548.17 458.20 549.98 460.06 550.87C464.33 552.92 465.48 556.89 466.73 561.39C467.33 563.52 468.08 563.84 465.82 564.92C442.19 577.84 418.37 590.76 397.66 608.43C396.42 609.99 392.52 613.84 389.63 615.18C387.44 616.21 384.35 616.05 382.01 616.35C378.82 616.76 375.63 617.13 372.44 617.55C370.84 617.76 356.67 621.50 357.70 616.48C358.06 614.72 359.34 614.13 359.34 612.14C359.34 611.37 359.91 607.40 359.18 606.94C356.97 605.54 354.13 604.74 351.63 604.01C350.39 603.65 348.99 600.18 348.01 600.34C342.38 601.28 342.00 595.49 341.09 594.55C340.00 593.44 337.99 593.18 336.99 592.24C335.87 591.18 337.11 588.90 336.50 587.56C335.72 585.88 334.26 584.34 332.86 583.30C330.46 581.52 328.24 579.46 326.07 577.38C320.69 572.21 315.42 566.91 310.07 561.71C289.44 541.65 268.83 521.65 247.05 502.93C241.86 498.45 236.63 494.03 231.37 489.64",
                name: "Algerie"
            },
            TUN: {
                path: "M428.79 409.91C429.18 408.55 430.48 408.12 431.52 407.44C433.13 406.37 433.35 405.31 435.13 404.13C436.56 403.19 437.73 401.31 438.40 399.60C439.73 396.18 439.68 393.43 440.14 390.08C440.42 387.97 439.30 386.01 439.75 383.91C440.27 381.52 443.24 377.15 439.59 376.00C441.07 374.51 443.31 373.87 444.51 372.06C444.95 371.39 444.81 370.16 445.76 369.96C446.81 369.75 447.42 370.10 448.30 369.28C450.23 367.49 452.14 366.79 454.68 366.26C455.86 366.02 457.51 365.26 458.69 365.87C460.09 366.60 458.58 367.21 458.64 368.36C459.85 368.46 460.19 367.86 459.57 366.77C461.74 367.47 462.41 367.17 463.12 369.34C463.44 370.29 462.20 370.27 463.32 371.25C464.18 372.00 464.22 373.18 463.31 373.87C463.38 373.80 464.23 375.05 465.24 374.72C466.60 374.26 467.81 373.24 468.97 372.39C469.42 372.06 471.01 370.56 471.66 370.94C473.22 371.85 472.86 373.49 472.00 374.82C470.36 377.36 465.32 379.49 464.90 382.51C464.58 384.77 465.64 387.62 467.51 388.90C470.35 390.83 470.25 390.90 470.65 394.52C471.16 399.09 467.75 403.49 464.20 405.93C460.68 408.36 455.51 409.45 458.32 414.99C458.94 416.20 459.80 417.37 460.98 418.06C462.29 418.82 462.92 417.98 464.16 418.27C464.57 418.37 464.65 420.49 464.86 420.96C465.38 422.09 467.38 419.05 468.29 419.48C469.54 420.08 468.57 421.09 468.88 422.03C469.31 423.33 471.07 424.63 469.12 424.67C470.04 425.88 472.36 424.83 473.19 426.21C473.89 427.37 472.22 431.48 472.37 433.09C472.59 435.51 474.18 436.66 471.54 438.01C468.93 439.34 463.71 440.62 462.05 442.62C461.15 443.24 461.27 445.28 460.05 445.67C457.46 446.52 455.00 447.17 455.65 451.23C456.17 454.47 457.13 457.06 455.10 460.03C452.73 463.48 450.80 464.71 447.04 466.05C446.69 460.06 445.55 454.21 444.93 448.25C444.29 442.08 444.01 438.53 439.33 435.27C437.15 433.74 436.25 432.04 435.90 429.34C435.60 426.96 434.72 425.22 432.79 423.79C431.82 423.08 430.88 422.49 430.30 421.32C429.71 420.11 430.08 418.59 429.48 417.37C428.25 414.85 427.67 412.23 428.79 409.91",
                name: "Tunisie"
            },
            LIB: {
                path: "M445.10 468.75C443.70 467.26 447.08 465.94 447.96 465.60C450.59 464.60 452.01 464.02 453.76 461.56C455.17 459.59 456.49 458.69 456.24 455.97C456.03 453.63 455.18 451.21 455.61 448.82C456.21 445.55 459.98 446.73 460.80 444.41C461.68 441.92 463.79 440.78 465.93 439.94C467.56 439.30 472.79 438.29 473.02 436.03C473.14 434.90 472.13 434.11 472.35 432.92C472.74 430.73 473.02 428.53 473.41 426.35C475.32 428.00 477.99 428.98 480.06 430.57C482.23 432.23 484.80 432.96 487.49 432.88C490.22 432.81 492.37 431.20 495.06 432.48C497.45 433.63 500.07 433.95 502.38 435.22C504.45 436.36 506.03 438.23 508.12 439.30C509.95 440.23 512.57 439.64 514.16 441.00C516.02 442.60 516.18 445.09 516.37 447.42C516.61 450.41 517.51 452.85 519.55 455.01C523.22 458.92 528.20 458.51 532.91 459.82C537.63 461.14 544.27 464.00 547.84 467.57C550.69 470.43 553.16 475.05 557.60 475.02C562.72 474.98 568.55 470.78 570.14 465.57C570.88 463.17 569.45 461.12 568.92 458.85C568.33 456.35 567.98 453.50 569.00 451.05C570.87 446.55 578.68 441.45 583.33 441.68C585.74 441.80 587.29 440.12 589.53 440.13C591.81 440.14 594.23 440.31 596.39 441.06C598.92 441.94 601.07 443.44 603.43 444.65C606.24 446.08 605.43 446.43 605.35 449.09C605.28 451.25 608.57 451.99 610.04 452.23C612.91 452.70 614.66 454.22 617.25 455.25C619.83 456.28 622.68 455.59 625.32 456.34C626.82 456.75 628.84 460.11 628.16 461.72C627.44 463.42 625.35 463.69 624.89 465.64C624.26 468.33 625.76 470.49 626.00 473.06C626.27 475.95 624.29 478.32 623.15 480.72C621.94 483.26 624.26 486.60 624.45 489.36C624.78 494.05 625.20 498.50 625.07 503.28L617.28 626.94C613.36 626.60 609.43 626.26 605.50 625.92C605.41 628.29 605.12 630.65 605.11 633.03L515.91 569.61L493.69 578.41C491.84 578.76 489.89 575.51 488.93 574.33C484.92 569.39 480.23 568.05 474.49 566.16C472.44 565.48 469.73 564.99 467.97 563.63C466.57 562.55 466.11 559.80 465.63 558.19C464.23 553.46 462.15 552.03 457.99 549.97C456.61 549.29 455.35 547.91 453.78 547.82C452.25 547.73 450.45 549.36 449.15 547.62C448.09 546.20 446.37 542.66 446.49 540.84C446.76 537.04 446.52 535.62 444.79 532.22C443.46 529.59 438.70 524.73 441.20 521.60C444.08 517.99 447.86 519.79 446.72 513.37C446.16 510.16 445.76 507.70 447.07 504.60C448.19 501.95 448.91 499.74 448.18 496.83C447.42 493.78 448.46 490.88 448.98 487.88C449.59 484.34 449.38 480.69 448.53 477.21C447.80 474.23 446.61 471.38 445.10 468.75",
                name: "Libye"
            }
        },
        width: 600,
        height: 900,
        projection: {
            type: "mill",
            centralMeridian: -5.5
        },
    });

    $('#maghreb').vectorMap({
        map: 'morocco_map',
        backgroundColor: "#f5f5f5",
        ref: "map",
        regionsSelectable: false,
        regionsSelectableOne: false,
        showTooltip: true,
        enableZoom: true,
        panOnDrag: false,
        containerStyle: {
            width: "10%",
            height: "100%"
        },


        series: {
            regions: [{
                values: gdpData,
                scale: ['#fefff9', '#f52a2a'],
                legend: {
                    vertical: true
                }
            }]
        },
        selectedRegions: ['MAR'],
        focusOn: {
            x: -0.2,
            y: .6,
            scale: 1
        },
        // markers: mapRegions,
        zoomMin: 2,
        zoomMax: 2,
        regionStyle: {
            initial: {
                fill: '#C2272C',
                "fill-opacity": 1,
                stroke: 'black',
                "stroke-width": .5,
                "stroke-opacity": 1
            },
        },
        onRegionTipShow: (e, a, t) => {
            $(a).append($("<br/>"));
            $(a).append($("<span/>", {
                'class': 'cases',
                'html': 'Cas Confirmes : ' + gdpData[t]
            }));
        },
    });
});